document.addEventListener("DOMContentLoaded",()=>{const e=L.map("tarina-map").setView([62.336,26.046],10);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(e);let t=[],n=0,o=[],a=null;const s=document.getElementById("step-title"),l=document.getElementById("step-counter"),r=document.getElementById("step-description"),i=document.getElementById("step-image"),d=document.getElementById("image-placeholder"),c=document.getElementById("prev-btn"),p=document.getElementById("next-btn");function m(a){if(a<0||a>=t.length)return;n=a;const m=t[a];s.textContent=m.title,l.textContent=`Askel ${a+1} / ${t.length}`,r.textContent=m.description,m.image_url?(i.src=m.image_url,i.style.display="block",d.style.display="none"):(i.style.display="none",d.style.display="block");const g=parseFloat(m.lat),y=parseFloat(m.lng);e.flyTo([g,y],13),o.forEach((e,t)=>{t===a?(e.setZIndexOffset(1e3),e.getElement().style.transform+=" scale(1.2)",e.getElement().style.filter="drop-shadow(0 0 5px rgba(0,0,0,0.5))"):(e.setZIndexOffset(0),e.getElement()&&(e.getElement().style.filter="none"))}),c.disabled=0===a,p.disabled=a===t.length-1}Papa.parse("tarinakartta_data.csv",{download:!0,header:!0,skipEmptyLines:!0,complete:function(n){t=n.data.sort((e,t)=>parseInt(e.step_order)-parseInt(t.step_order)),t.length>0&&function(){const n=[];t.forEach((t,a)=>{const s=parseFloat(t.lat),l=parseFloat(t.lng);if(isNaN(s)||isNaN(l))return;const r=L.marker([s,l],{icon:L.divIcon({className:"custom-div-icon",html:`<div style="background-color:#0056b3; color:white; border-radius:50%; width:24px; height:24px; display:flex; align-items:center; justify-content:center; border:2px solid white; font-weight:bold;">${a+1}</div>`,iconSize:[24,24],iconAnchor:[12,12]})}).addTo(e);r.on("click",()=>{m(a)}),o.push(r),n.push([s,l])}),n.length>1&&(a=L.polyline(n,{color:"#0056b3",weight:3,opacity:.5,dashArray:"5, 10"}).addTo(e));m(0)}()},error:function(e){console.error("Virhe tarinadatan latauksessa:",e),s.textContent="Virhe datan latauksessa"}}),c.addEventListener("click",()=>m(n-1)),p.addEventListener("click",()=>m(n+1))});